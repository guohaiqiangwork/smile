<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>首页</title>
		<link href="css/mui.min.css" rel="stylesheet" />
		<link href="css/icons-extra.css" rel="stylesheet" />
		<style>
			body {
				background: white;
			}
			
			.mui-bar-tab .mui-tab-item.mui-active {
				color: #E02D26;
			}
		</style>
	</head>
	<body>
		<nav class="mui-bar mui-bar-tab">
			<a class="mui-tab-item mui-active" data-id="homePage.html">
				<span class="mui-icon mui-icon-home"></span>
				<span class="mui-tab-label">首页</span>
			</a>
			<a class="mui-tab-item" data-id="category.html">
				<span class="mui-icon mui-icon-extra mui-icon-extra-new"></span>
				<span class="mui-tab-label">分类</span>
			</a>
			<a class="mui-tab-item" data-id="shopCart.html">
				<span class="mui-icon mui-icon-search"></span>
				<span class="mui-tab-label">购物车</span>
			</a>
			<a class="mui-tab-item" data-id="personalCenter.html">
				<span class="mui-icon mui-icon-chat"></span>
				<span class="mui-tab-label">我的</span>
			</a>
		</nav>

		<script src="js/mui.js"></script>
		<script src="js/commonFun.js"></script>
		<script src="js/requestFun.js"></script>
		<script type="text/javascript">
			mui.init();
			var subpage_style = {
				top: '0px',
				bottom: '51px',
				render: 'always'
			};
			var self = null;
			var activeTab = null;
			mui.plusReady(function() {
				//关闭右滑返回
				plus.webview.currentWebview().setStyle({
					'popGesture': 'none'
				});
				self = plus.webview.currentWebview();
				var sub = plus.webview.create("views/homePage.html", "homePage.html", subpage_style);
				self.append(sub);
				activeTab = "homePage.html";

				//选择底部菜单
				mui('.mui-bar-tab').on('tap', 'a', function(e) {
					var targetTab = this.getAttribute('data-id');
					if (targetTab == activeTab) {
						return;
					}
					var _subWv = plus.webview.getWebviewById(targetTab);

					if (targetTab != 'homePage.html') {
						getUserDetail(mui, plus.storage.getItem('memberId'), function(data) {
							if (data.code == 401 || data.code == 1500) {
								var loginSign = true;
								mui.openWindow({
									url: "login.html",
									id: "login",
									show: {
										aniShow: "slide-in-right"
									}
								});
							} else {
								var list = plus.webview.currentWebview().opener();
								mui.fire(list, 'refreshMajorGuestCount');
								//如果不存在则创建
								if (!_subWv) {
									_subWv = plus.webview.create("views/" + targetTab, targetTab, subpage_style);
									self.append(_subWv);
								}
								_subWv.show();
								// 隐藏之前的webview
								plus.webview.getWebviewById(activeTab).hide('none');
								activeTab = targetTab;
								 if(!mui.os.ios){
								    if(targetTab == 'personalCenter.html'){
								    	plus.webview.getWebviewById(targetTab).reload();
								    }
								 }else{
									 var list = plus.webview.currentWebview().opener();
									 mui.fire(list, 'refreshMajorGuestCount');
								 }
								
								
							}
						});
					} else {
						//如果不存在则创建
						if (!_subWv) {
							_subWv = plus.webview.create("views/" + targetTab, targetTab, subpage_style);
							self.append(_subWv);
						}
						_subWv.show();
						// 隐藏之前的webview
						plus.webview.getWebviewById(activeTab).hide('none');
						activeTab = targetTab;
					}

				});

			});
		</script>
	</body>
</html>
