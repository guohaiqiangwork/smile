<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../css/mui.min.css">

		<link rel="stylesheet" href="../css/font-awesome.min.css">
		<!-- 引用外部css -->
		<link rel="stylesheet" type="text/css" href="../css/view/homePage.css" />
		<link rel="stylesheet" type="text/css" href="../css/common.css" />


	</head>
	<body>
		<header class="header_white" style="height:1rem ;">
			<div class="div_display margin_top3">
				<!-- 消息 -->
				<div class="header_title_left" id="messageId">
					<div class="div_backgroun_jb header_title_leftT"></div>
					<img src="../image/news@2x.png" class="header_title_leftI">
				</div>
				<!-- log -->
				<div class="header_title_center">
					<img src="../image/headerT.png" class="header_title_centerI">
				</div>
				<!-- 搜索 -->
				<div class="header_title_right" >
					<img src="../image/search@2x.png" class="header_title_rightI">
				</div>
			</div>
		</header>
		<div class="mui-content" id="heardD">
			<div id="slider" class="mui-slider mui-fullscreen" style="height: 0.9rem;width: 90%;">
				<div id="sliderSegmentedControl" class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
					<div class="mui-scroll" style="touch-action: none;"
					 id="homePageTitleNavId">
						
					</div>
				</div>
			</div>
			<div class="allCategories">
				<img src="../image/icon_down_up.png">
			</div>
		</div>

		<!-- 全部分类区域 -->
		<div class="whole" id="wholeId">
			<div>
				<div class="titNav">
					<div id="message">全部选项</div>
					<!-- 向上箭头 -->
					<div id="jt">
						<img src="../image/icon_down_up.png" />
					</div>
				</div>
			</div>
			<!-- <div class="capsule capsuleSelection">
				热门
			</div> -->
		</div>


		<!-- 轮播图 -->
		<div class="mui-content lobotuTitle" id="goLogin">
			<div class="lunbo">
				<div class="mui-slider">
					<div class="mui-slider-group mui-slider-loop">

					</div>
					<div class="mui-slider-indicator mui-slider-indicatorTwo">
					</div>
				</div>
			</div>
		</div>

		<!-- 新品发现 -->
		<div>
			<div id="goToPay">
				<i class="fa fa-circle"></i>&nbsp; 新品发现 &nbsp;<i class="fa fa-circle"></i>
			</div>

			<!-- <div class="mui-content newShoping" id="newShopingID">
			</div> -->


			<div class="mui-content">
				<div id="sliderSegmentedControl" class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
					<div class="mui-scroll newShoping" style="touch-action: none;" id="newShopingID">


					</div>
				</div>

			</div>
			
		</div>
		
		<!-- 广告 -->
		<div class="guangg">
			<img id="imgPara" />
		</div>
		<!-- - 热门- -->
		<div class="mdss" id="mdsc">
			-- <span class="hostClass">热门</span> --
		</div>
		<div class="guanggTwo">
			<img id="imgParaTwo" />
		</div>
		
		<!-- 最下面模块list -->
		<div class="bottomList" id="bottomListTwo">
			
		</div>
		
		<div id="moveLocation" class="locationBtn">
			<img src="../image/position.png">
		</div>
		
		<button id="messageId">去消息页面</button>
	</body>

	<script src="../js/mui.min.js"></script>
	<script src="../js/jquery-1.11.2.min.js"></script>
	<script src="../js/commonFun.js"></script>
	<script src="../js/requestFun.js"></script>
	<script src="../js/rem_reset.js"></script>
	<script src="../js/domMove.js"></script>
	<script src="../js/variousMethods.js"></script>
	
	<!-- 调用后端接口方法 -->
	<script src="../js/returnList.js" type="text/javascript"></script>


	<script>
		(function($, doc, $$, undefined) {
			$$.init();
			var _self;
			if (window.plus) {
				plusReady();
			} else {
				doc.addEventListener('plusready', plusReady, false);
			}
			
			function plusReady() {
				plus.navigator.setFullscreen(false);
				//强制竖屏		
				plus.screen.lockOrientation("portrait-primary");
				//强制隐藏滚动条			
				plus.webview.currentWebview().setStyle({
					scrollIndicator: 'none'
				});

				_self = plus.webview.currentWebview();
				var getOrderDetailWai = plus.nativeUI.showWaiting("信息加载中...");
				var userSessionId = plus.storage.getItem('userSessionId');
				//设置系统状态栏背景色
				// plus.navigator.setStatusBarBackground('#6495ED')
				/* $('#heardD').scroll({
					indicators: false //是否显示滚动条
				}); */

				getOrderDetailWai.close();


				/* 去搜索页 */
				var mdsc = doc.getElementById('mdsc');
				mdsc.onclick = function(){
					$$.openWindow({
						url: 'searchPage.html',
						id: 'searchPage',
						show: {
							aniShow: "slide-in-right"
						}
					});
				};
				
				// 点击选择全部分类
				$(".whole").on("tap", ".capsule", function() {
					var matId = Number($(this).attr("markerId")) + 1;
					var homePageTitleNavId = doc.getElementById("homePageTitleNavId");
					$("#homePageTitleNavId .mui-active").removeClass('mui-active');
					homePageTitleNavId.querySelector('.mui-control-item:nth-child('+matId+')').classList.add('mui-active');
					
					plus.storage.setItem("code_id", $(this).attr("code-id"));
					plus.storage.setItem("goodsName", $(this).attr("data-id"));
					
					getHomeGoodsBySort(mui, $(this).attr("code-id"), function(data) {
					    homePageBottomList(data);
					});
					
					
					
					var $this = $(this);
					$(".hostClass").html($(this).attr("data-id"));
					/* 点击选项卡去指定的列表模块 */
					window.scrollTo(0, 465);
					if ($(this).hasClass("capsuleSelection")) {
						return
					} else {
						$(this).addClass("capsuleSelection").siblings("div").removeClass("capsuleSelection");
					}
					// console.log($(this).text())
				});
				
				
		
				
				// 点击展开全部选项栏
				$(".allCategories").on("tap", function() {
					$(".whole").css("display", "block")
				})
				// 关闭全部选项栏
				$("#jt").on("tap", function() {
					$(".whole").css("display", "none")
				})

				$('#goLogin').on('tap', function() {
					$$.openWindow({
						url: '../login.html',
						id: 'login',
						show: {
							aniShow: "slide-in-right"
						}
					});
				})

				// 轮播
				getImage(); //获取

				var slider = mui("#slider");
				slider.slider({
					interval: 3000
				});

				function getImage() {
					getLB(mui, "", function(data) {
						if (data.code == 200) {
							var dataList = data.data;
							var length = dataList.length

							if (length == 1) {
								$('.mui-slider-group').append('<div class="mui-slider-item"><img class="lunbo-img" src="' + dataList[0].carousel +
									'" /></div>');
							} else {
								$('.mui-slider-group').append(
									'<div class="mui-slider-item mui-slider-item-duplicate"><img class="lunbo-img" src="' + dataList[length -
										1].carousel +
									'" /></div>');
								$('.mui-slider-indicatorTwo').append('<div class="mui-indicator mui-active"></div>');
								for (var i = 0; i < length; i++) {
									$('.mui-slider-group').append('<div class="mui-slider-item"><img class="lunbo-img" src="' + dataList[i].carousel +
										'" /></div>');
								}
								$('.mui-slider-group').append(
									'<div class="mui-slider-item mui-slider-item-duplicate"><img class="lunbo-img" src="' + dataList[0].carousel +
									'" /></div>');
								for (var i = 0; i < length - 1; i++) {
									$('.mui-slider-indicatorTwo').append('<div class="mui-indicator"></div>');
								}
							}
							var gallery = mui('.mui-slider');
							gallery.slider({
								interval: 5000 //自动轮播周期，若为0则不自动播放，默认为0；
							});
						} else {
							tipShow(data.message);
						}
					})
				}

				/* 获取新品发现list */
				getNewGoods(mui, "", function(data) {
					if (data.code == 200) {
						var newShopingID = document.getElementById("newShopingID");
						var htmlTwo = [];
						var dataListTwo = data.data;
						for(i=0;i<dataListTwo.length;i++){
							htmlTwo.push('<div class="gotoDetails" data-id='+ dataListTwo[i].id+'><div><img src="'+ dataListTwo[i].pictureUrl+'"></div>');
							htmlTwo.push('<div>'+ dataListTwo[i].goodsName+'</div><div>'+ dataListTwo[i].title+'</div>')
							htmlTwo.push('<div><span>￥'+ dataListTwo[i].price+'</span><i class="fa fa-shopping-cart"></i></div></div>')
						}
						newShopingID.innerHTML = htmlTwo.join('');
					} else {
					    tipShow(data.message);
					}
				});
				
				/* 获取banner图 （广告图上）*/
				var dataBase = {
					isShow: 1,
					position: 1,
				};
				getBanner(mui, dataBase, function(data) {
					if (data.code == 200) {
						document.getElementById("imgPara").src = data.data.banner;
					} else {
						tipShow(data.message);
					}
				});
				/* 获取banner图 （广告图下）*/
				var dataBase = {
					isShow: 1,
					position: 2,
				};
				getBanner(mui, dataBase, function(data) {
					if (data.code == 200) {
						document.getElementById("imgParaTwo").src = data.data.banner;
					} else {
						tipShow(data.message);
					}
				});
				
				/*下半部分list 跳转到详情页 */
				$(".bottomList").on("tap",".newShopingIDTwo",function(e){
					$$.openWindow({
						url: 'details.html',
						id:'details',
						extras: {
							"shopId": $(this).attr('data-id')
						},

						show: {
							aniShow: "slide-in-right"
						}
					});
				});
				
				/*新品发现 跳转到详情页 */
				$("#newShopingID").on("tap",".gotoDetails",function(e){
					$$.openWindow({
						url: 'details.html',
						id: 'details',
						extras: {
							"shopId": $(this).attr('data-id')
						},
						show: {
							aniShow: "slide-in-right"
						}
					});
				});


				/* 去消息页面 */
				var messageId = doc.getElementById('messageId');
				messageId.onclick = function() {
					$$.openWindow({
						url: '../pages/newsPage.html',
						id: 'newsPage',
						show: {
							aniShow: "slide-in-right"
						}
					});
				};


				/* 去登录页 */
				var goToPay = doc.getElementById('goToPay');
				goToPay.onclick = function() {
					$$.openWindow({
						url: '../login.html',
						id: 'login',
						show: {
							aniShow: "slide-in-right"
						}
					});
				};
				
				
				/* 获取头部标题栏选项卡 */
				getHot(mui, "", function(data) {
				    if (data.code == 200) {
						var dataNav = data.data;
						var homePageTitleNavId = doc.getElementById("homePageTitleNavId");
						$.each(dataNav, function(index) {
							$('#homePageTitleNavId').append(
								'<div class="mui-control-item" markerId='+index+' data-id='+ dataNav[index].name +' code-id='+ dataNav[index].code +'>'+dataNav[index].name+'</div>'
							)
						});
						/* 标题栏 默认选中第一个 */
						homePageTitleNavId.querySelector('.mui-control-item').classList.add('mui-active'); 
						
						$(".hostClass").html(dataNav[0].name);
						plus.storage.setItem("code_id", dataNav[0].code);
						plus.storage.setItem("goodsName", dataNav[0].name);
						
						// 全部分类展示
						//var a = ["面点速食", "酒水饮料", "酒水饮料", "美妆百货", "中外茶叶", "母婴保健", "家装家纺", "日用纸品", "电子数码", "健康体检"]
						$.each(dataNav, function(index) {
							$('.whole').append(
								'<div  class="capsule" markerId='+index+' data-id='+ dataNav[index].name +' code-id='+ dataNav[index].code +'>' + dataNav[index].name + '</div>'
							)
						});
						var wholeId = doc.getElementById("wholeId");
						wholeId.querySelector('.capsule').classList.add('capsuleSelection'); 
					} else {
					    tipShow(data.message);
					}
				});

				
				/* 点击头部选项卡，页面移动到指定位置 */
				$("#homePageTitleNavId").on("tap",'.mui-control-item',function(){
					var matId = Number($(this).attr("markerId")) + 2;
					var wholeId = doc.getElementById("wholeId");
					$("#wholeId .capsuleSelection").removeClass('capsuleSelection');
					wholeId.querySelector('.capsule:nth-child('+matId+')').classList.add('capsuleSelection');
					
					plus.storage.setItem("code_id", $(this).attr("code-id"));
					plus.storage.setItem("goodsName", $(this).attr("data-id"));
					
					$(".hostClass").html(this.innerText);
					var ele = doc.getElementById("mdsc");
					window.scrollTo(0, 465);
					
					getHomeGoodsBySort(mui, $(this).attr("code-id"), function(data) {
					    homePageBottomList(data);
					});
				});
				
				/* 默认获取页面下部分list*/
				getHomeGoodsBySort(mui, plus.storage.getItem("code_id"), function(data) {
				    homePageBottomList(data);
				});
				
				/* 点击更多跳到更多页面 */
				$("#bottomListTwo").on("tap",'#gd',function(){
					if(!plus.storage.getItem('Token')){
						tipShow("请先登录");
						$$.openWindow({
							url: '../login.html',
							id:'login',
							show: {
								aniShow: "slide-in-right"
							}
						});
					}else{
						var code_id = plus.storage.getItem("code_id");
						var goodsName = plus.storage.getItem("goodsName");
						$$.openWindow({
							url: 'more.html',
							id:'more',
							extras: {
								"code": code_id,
								"goodsName": goodsName,
							},
							show: {
								aniShow: "slide-in-right"
							}
						});
					}
				});	
			}
		})(jQuery, document, mui);
	</script>
