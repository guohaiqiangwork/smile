<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>my_setting</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../css/font-awesome.min.css">
		<link rel="stylesheet" href="../css/mui.min.css">
		<link rel="stylesheet" href="../css/common.css">
		<script src="../js/rem_reset.js"></script>

		<link rel="stylesheet" type="text/css" href="../css/pages/updateName.css" />
	</head>
	<body onselectstart="return false">
		<header class="header_white title">
			<i class="mui-action-back" style="touch-action: none;"><img src="../image/left@2x.png" style="width: .22rem;height: .39rem;"></i>
			设置用户名
		</header>

		<div class="content">
			<input id='result' type="text" placeholder="请输入喜爱的用户名">
			<div>
				<span>用户名长度不能大于16个字符</span>
			</div>
			<div>
				<button id="insertName" type="button">保 存</button>
			</div>
		</div>

	</body>
	<script src="../js/jquery-1.11.2.min.js"></script>
	<script src="../js/mui.min.js"></script>
	<script src="../js/requestFun.js"></script>
	<script src="../js/commonFun.js" type="text/javascript"></script>

	<script>
		(function($, doc, $$) {
			$$.init();
			var _self;
			if (window.plus) {
				plusReady();
			} else {
				doc.addEventListener('plusready', plusReady, false);
			}

			function plusReady() {
				plus.navigator.setFullscreen(false);
				//强制竖屏
				plus.screen.lockOrientation("portrait-primary");
				//强制隐藏滚动条
				plus.webview.currentWebview().setStyle({
					scrollIndicator: 'none'
				});
				_self = plus.webview.currentWebview();

				/* 接收传过来的用户名，并且赋值 */
				var result = doc.getElementById("result");
				result.value = _self.namepara;
				var id = _self.idPara;
				if (!id) {
					tipShow("缺少用户id");
				}

				var insertName = doc.getElementById('insertName');
				insertName.addEventListener('tap', function(event) {
					var reg = /[^\a-\z\A-\Z0-9\u4E00-\u9FA5\@\.]/g;
					if (reg.test(result.value)) {
						tipShow("不允许输入特殊字符");
						return
					} else if (result.value.length > 16) {
						tipShow("不能大于16位");
					} else if (result.value === _self.namepara) {
						tipShow("请修改后提交");
					} else {
						if (plus.storage.getItem('Token')) {
							var dataBase = {
								nickname: result.value.replace(/\s*/g, ""),
								id: id,
							};
							updateName(mui, dataBase, function(data) {
								if (data.code == 200) {
									mui.alert('保存成功！', '提示', function() {
										plus.nativeUI.closeWaiting();
										mui.back();
										var list = plus.webview.currentWebview().opener();
										mui.fire(list, 'refreshMajorGuestCount');
									});

								} else {
									tipShow(data.message);
								}
							})
						} else {
							tipShow("您还没有登录");
						}
					}
				}, false);

				/* $$.fire(plus.webview.getWebviewById('pSetting.html'), "aaa"); */
			}
		})(jQuery, document, mui);
	</script>

</html>
