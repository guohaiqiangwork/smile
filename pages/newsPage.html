

<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>my_setting</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../css/font-awesome.min.css">
		<link rel="stylesheet" href="../css/mui.min.css">
		<link rel="stylesheet" href="../css/common.css">
		<script src="../js/rem_reset.js"></script>
		
		<link rel="stylesheet" type="text/css" href="../css/view/seavhPage.css"/>
		
		<link rel="stylesheet" type="text/css" href="../css/pages/updateName.css"/>
		
		<link rel="stylesheet" type="text/css" href="../css/pages/newsPage.css"/>
		
		<link rel="stylesheet" href="../css/pages/shopCart.css" />
		
		<style type="text/css">
			p {
			    margin-bottom: 5px;
			}
		</style>
	</head>
	<body>
		<header class="header_white title">
			<i id="returnTopPage_set"><img src="../image/left@2x.png" style="width: .22rem;height: .38rem;"></i>
			<span style="margin-right: 0.3rem;">消息通知</span>
		</header>
		
		<div style="height: 65px;"></div>
		
		<!-- 消息列表 -->
		<div id="massageListId">
			<!-- <div id="messageCount">
				<div class="messageCount_divOne">
					<div>
						<span>05:41</span>
					</div>
				</div>
				<div id="messageCount_divTwo">
					<div class="messageCount_divThree">
						<p style="color: #333333;font-weight:bold">
							<i class="fa fa-search"></i>
							新人消息通知
						</p>
						<p>客服在线时间：早8：00-晚18：00</p>
					</div>
					<div class="findMessageId">
						<dd class="yuanq"></dd>
						<dl>查看详情</dl>
					</div>
				</div>
			</div> -->

		</div>
		
		<!-- 最底部的已查看全部消息 -->
		<div class="bottomClass" style="display: none;">
			<span>——  已查看完全部消息  ——</span>
		</div>
		
		
		<!-- 缺省页 -->
		<div id="cartDefaultId" style="display: none;">
			<div id="cartDefaultId_one">
				<img src="../image/default/news.png" >
			</div>
			<div id="cartDefaultId_two">
				<span>您暂时还没有任何消息哦~</span>
			</div>
		</div>
		
		
	</body>
	<script src="../js/jquery-1.11.2.min.js"></script>
	<script src="../js/mui.min.js"></script>
	<script src="../js/requestFun.js"></script>
	<script src="../js/commonFun.js" type="text/javascript"></script>
	
	<script>
		(function($, doc, $$) {
			$$.init();
			var _self;
			if (window.plus) {
				plusReady();
			} else {
				doc.addEventListener('plusready', plusReady, false);
			}

			function plusReady() {
				plus.navigator.setFullscreen(false);
				//强制竖屏
				plus.screen.lockOrientation("portrait-primary");
				//强制隐藏滚动条
				plus.webview.currentWebview().setStyle({
					scrollIndicator: 'none'
				});
				_self = plus.webview.currentWebview();
				
				//返回上一页
				var returnTopPage_set = doc.getElementById("returnTopPage_set");
				returnTopPage_set.onclick = function() {
					plus.nativeUI.closeWaiting();
					mui.back();
					var list = plus.webview.currentWebview().opener();
					mui.fire(list, 'refreshHomeNews');
				}
				
				//监听消息返回刷新消息
				window.addEventListener('refreshHomeNewsTwo', function(event) {
					getNewMessage()
				});
				
				
				getNewMessage();
				/* 获取消息列表 */
				function getNewMessage(){
					messageList(mui,plus.storage.getItem('memberId'),function(data){
						if (data.code == 200) {
							var messageData = data.data;
							if(messageData.length != 0){
								$(".bottomClass").css("display","block");
								$("#cartDefaultId").css("display","none");
								var fragmentplanList = document.createDocumentFragment();
								mui.each(messageData,function (index,row) {
									var yuanqParams = "";
									if(row.isRead == "0"){
										yuanqParams = "yuanq";
									}else{
										yuanqParams = "";
									}
									var list = 
									'<div id="messageCount">'+
										'<div class="messageCount_divOne">'+
											'<div>'+
												'<span>'+row.createTime+'</span>'+
											'</div>'+
										'</div>'+
										'<div id="messageCount_divTwo">'+
											'<div class="messageCount_divThree">'+
												'<p style="color: #333333;font-weight:bold">'+
													'<i class="fa fa-search"></i>'+row.title+''+
												'</p>'+
												'<p>'+row.content+'</p>'+
											'</div>'+
											'<div style="touch-action: none;" id="findMessageId" messageId='+row.id+'>'+
												'<dd class='+yuanqParams+'></dd>'+
												'<dl>查看详情</dl>'+
											'</div>'+
										'</div>'+
									'</div>';
									$(fragmentplanList).append(list);
								});
								/* 删除子标签 */
								$('#massageListId').empty();
								$("#massageListId").append($(fragmentplanList));
							}else{
								$("#cartDefaultId").css("display","block");
							}
						} else {
							tipShow(data.message);
						}
					});
				};
				
				
				/* 查看消息 */
				$('#massageListId').on("tap","#findMessageId",function(){
					$$.openWindow({
						url: 'newsPageDetails.html',
						id:'newsPageDetails',
						extras: {
							"messageId": $(this).attr('messageId')
						},
						show: {
							aniShow: "slide-in-right"
						}
					});
				});
				
			}
		})(jQuery, document, mui);
	</script>

</html>

