<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>my_setting</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../css/font-awesome.min.css">
		<link rel="stylesheet" href="../css/mui.min.css">
		<link rel="stylesheet" href="../css/common.css">
		<link rel="stylesheet" href="../css/mobileReset.css">
		<style type="text/css">
			.center_share {
				height: 2rem;
				padding-bottom: .3rem;
				position: fixed;
				bottom: 0;
			}
		</style>
		<script src="../js/rem_reset.js"></script>
	</head>
	<body onselectstart="return false;">
		<header class="header_white">
			<i class="mui-action-back"><img src="../image/left@2x.png"></i>
			活动页面
		</header>
		<div class="content">
			<div style="text-align: center;width: 7.5rem;" id="imgList">

			</div>
			<!-- 分享 -->
			<div class="center_share" style="background-color: #FFFFFF;width: 7.5rem;height: 3rem;">
				<div class="font_size26 font_color33  margin_top2" style="margin-left: 3rem;">
					分享至
				</div>
				<div class="div_display">
					<div class="margin_top5" style="margin-left: 2rem;" id="wxFX">
						<div class="">
							<img src="../image/wxf.png" style="width: .6rem;height: .6rem;">
						</div>
						<div class="font_size24 font_color33" style="margin-left: -.1rem;">
							微信好友
						</div>
					</div>
					<div class="margin_top5" style="margin-left: 1.5rem;" id="qqFX">
						<div class="">
							<img src="../image/qq.png" style="width: .6rem;height: .6rem;">
						</div>
						<div class="font_size24 font_color33" style="font-family: inherit;">
							QQ好友
						</div>
					</div>
				</div>


			</div>

		</div>

	</body>
	<script src="../js/jquery-1.11.2.min.js"></script>
	<script src="../js/mui.min.js"></script>
	<script src="../js/commonFun.js"></script>
	<script src="../js/requestFun.js"></script>
	<script src="../js/share.js"></script>
	<script>
		(function($, doc, $$, undefined) {
			$$.init();
			var _self;
			if (window.plus) {
				plusReady();
			} else {
				doc.addEventListener('plusready', plusReady, false);
			}

			function plusReady() {
				plus.navigator.setFullscreen(false);
				//强制竖屏
				plus.screen.lockOrientation("portrait-primary");
				//强制隐藏滚动条
				plus.webview.currentWebview().setStyle({
					scrollIndicator: 'none'
				});
				_self = plus.webview.currentWebview();
				if (_self.falgUrl == 'lb') {
					//alert("222")
					getFind(mui, _self.activityId, function(data) {
						//alert("11="+ JSON.stringify(data));
						var fragmentplanList = document.createDocumentFragment();
						if (data.code == 200) {
							$.each(data.data, function(items) {
								var orderLiTwo =
									'<img src="' + data.data[items] + '" class="width_height100">';
								$(fragmentplanList).append(orderLiTwo);
							});
							$("#imgList").append($(fragmentplanList));
						} else {
							tipShow(data.message)
						}

					});

				} else {
					getContentI(mui, _self.activityId, function(data) {
						var fragmentplanList = document.createDocumentFragment();
						if (data.code == 200) {
							console.log(JSON.stringify(data))
							var orderLiTwo =
								'<div class="">' +
								'<img src="' + data.data[0].detailsImg + '" class="width_height100">' +
								'</div>' +
								'<div class="">' +
								data.data[0].detailsTitle +
								'</div>' +
								'<div class="">' +
								data.data[0].detailsContent +
								'</div>';
							$("#imgList").append($(orderLiTwo));
						} else {
							tipShow(data.message)
						}

					});
				}

				userId = plus.storage.getItem('memberId');
				var shares = {};
				plus.share.getServices(function(s) {
					if (s && s.length > 0) {
						for (var i = 0; i < s.length; i++) {
							var t = s[i];
							shares[t.id] = t;
						}
					}
				}, function() {
					console.log("获取分享服务列表失败");
				});
				/* 点击分享按钮事件 微信*/
				$("#wxFX").on("tap", function() {
					if (plus.runtime.isApplicationExist({
							pname: 'com.tencent.mm',
							action: 'weixin://'
						})) {
						console.log("微信应用已安装");
					} else {
						$$.toast("微信应用未安装");
						setTimeout(function() {
							toCurrentPage();
						}, 1500);
						return false;
					}
					var shareJson = {
						"title": "笑容",
						"desc": "笑容app你好！"
					};
					var lineEndId = ['lineEnd'];
					var ids = [{
						id: "weixin",
						ex: "WXSceneSession"
					}, {
						id: "weixin",
						ex: "WXSceneTimeline"
					}];
					var i = 1
					if (i > 0) {
						var s_id = ids[i - 1].id;
						var share = shares[s_id];
						if (share) {
							if (share.authenticated) {
								shareMessageShare(share, ids[i - 1].ex, shareJson, userId, lineEndId);
								mui.fire(plus.webview.getWebviewById("index.html"));
								setTimeout(function() {
									toCurrentPage();
								}, 5000);
							} else {
								share.authorize(function() {
									shareMessageShare(share, ids[i - 1].ex, shareJson, userId, lineEndId);
									mui.fire(plus.webview.getWebviewById("index.html"));
									setTimeout(function() {
										toCurrentPage();
									}, 5000);
								}, function(e) {
									console.log("认证授权失败：" + e.code + " - " + e.message);
								});
							}
						} else {
							$$.toast("分享失败，请重试");
						}
					}
				});
				$("#qqFX").on("tap", function() {
					sqq = shares['qq'];
					var msg = {
						type: 'text'
					};
					if (false) {
						plus.nativeUI.alert('请输入要分享的内容!');
						return;
					}
					msg.title = '快来吧';
					msg.thumbs = ['../image/qq.png'];
					msg.pictures = ['../image/qq.png'];
					msg.href = 'http://www.baidu.com';
					sqq ? shareShare(sqq, msg) : plus.nativeUI.alert('当前环境不支持QQ分享操作!');
				});
			
			};



		})(jQuery, document, mui);
	</script>

</html>
