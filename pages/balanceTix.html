<!-- 余额提现 -->

<!-- 设置提现密码 -->

<!-- 搜索 -->

<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>my_setting</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../css/font-awesome.min.css">
		<link rel="stylesheet" href="../css/mui.min.css">
		<link rel="stylesheet" href="../css/common.css">
		<link rel="stylesheet" href="../css/passwordPopUp.css" />
		<script src="../js/rem_reset.js"></script>

		<link rel="stylesheet" type="text/css" href="../css/pages/updateName.css" />
	</head>

	<body>
		<header class="header_white title">
			<i class="mui-action-back"><img src="../image/returnButton.png" style="width: .22rem;height: .38rem;"></i>
			余额提现
		</header>

		<div style="height: 65px;"></div>

		<div id="balanceBody_id">
			<ul>
				<li class="li_one">
					<div>到账银行卡</div>
					<div class="li_one_div">
					</div>
					<div class="li_two_div">
						<i class="fa fa-angle-right"></i>
					</div>
				</li>

				<li class="li_two">
					<span>提现金额</span>
				</li>
				<li class="li_three">
					<span>￥</span>
					<span>
						<input type="number" id="balbnce_money"  style="font-size: .5rem;padding:0px;"/>
					</span>
				</li>
				<li class="li_four">
					<span> 余额￥
						<span id="li_four_money">

						</span>
					</span>
					<span id="allBalance"> 全部提现</span>
				</li>
				<li class="li_five">
					<span>提现</span>
				</li>
			</ul>
		</div>


		<!-- 密码提示框 -->
		<div id="pay" style="display: none;" data-disable-auto-close='true' class="box mui-popover mui-popover-action mui-popover-middle closeModel">
			<div id="password_div " style="height: 1rem;width:5.7rem float: left;border-bottom: 1px solid #EEEEEE;">
				<img src="../image/close.png" alt="" class="mui-popover-close closeModel" style="width: 0.37rem;height: 0.37rem;">
				<p class="title1">请输入密码</p>
			</div>
			<div class="type">提现</div>
			<div class="number1"></div>
			<div class="table">
				<div><span class="blackpwd"></span></div>
				<div><span class="blackpwd"></span></div>
				<div><span class="blackpwd"></span></div>
				<div><span class="blackpwd"></span></div>
				<div><span class="blackpwd"></span></div>
				<div><span class="blackpwd"></span></div>
			</div>
			<input style="text-indent: -999em;margin-left: -100%;width: 200%;opacity: 0;" type="tel" name='password' class="zfinput"
			 maxlength="6">
		</div>

	</body>
	<script src="../js/jquery-1.11.2.min.js"></script>
	<script src="../js/mui.min.js"></script>
	<script src="../js/requestFun.js"></script>
	<script src="../js/commonFun.js" type="text/javascript"></script>

	<script>
		(function($, doc, $$) {
			$$.init();
			var _self;
			if (window.plus) {
				plusReady();
			} else {
				doc.addEventListener('plusready', plusReady, false);
			}

			function plusReady() {
				plus.navigator.setFullscreen(false);
				//强制竖屏
				plus.screen.lockOrientation("portrait-primary");
				//强制隐藏滚动条
				plus.webview.currentWebview().setStyle({
					scrollIndicator: 'none'
				});
				_self = plus.webview.currentWebview();
				var bankCard_Id;
				var balbnce_money;
				// mui('#pay').popover('show');
				getBankFindAll(mui, plus.storage.getItem('memberId'), function(data) {
					console.log("银行卡信息==" + JSON.stringify(data))
					if (data.code == 200) {
						if (data.data.length > 0) {
							var fragmentplanList = document.createDocumentFragment();
							// 银行卡
							var bankCard = data.data[0].bankCard.substr(-4);
							console.log(JSON.stringify(data.data[0]))
							switch (data.data[0].bankCode) {
								case 'ICBC':
										data.data[0].bankBColor = 'bank_bgColor_zgp'
										data.data[0].imgUrl = '../image/bank/gsy.png';
										break;
								case 'ABC':
										data.data[0].bankBColor = 'bank_bgColor_ny'
										data.data[0].imgUrl = '../image/bank/nyy.png';
										break;
								case 'CCB':
										data.data[0].bankBColor = 'bank_bgColor_jj'
										data.data[0].imgUrl = '../image/bank/jsy.png';
										break;
								case 'BOC':
										data.data[0].bankBColor = 'bank_bgColor_zgp'
										data.data[0].imgUrl = '../image/bank/zgy.png';
										break;
								case 'COMM':
										data.data[0].bankBColor = 'bank_bgColor_jj'
										data.data[0].imgUrl = '../image/bank/jty.png';
										break;
								case 'PSBC':
										data.data[0].bankBColor = 'bank_bgColor_ny'
										data.data[0].imgUrl = '../image/bank/yzy.png';
										break;
								case 'SPDB':
										data.data[0].bankBColor = 'bank_bgColor_zgp'
										data.data[0].imgUrl = '../image/bank/qty.png';
										break;
								case 'CMB':
										data.data[0].bankBColor = 'bank_bgColor_zgp'
										data.data[0].imgUrl = '../image/bank/zsy.png';
										break;
								default:
										data.data[0].bankBColor = 'bank_bgColor_zgp'
										data.data[0].imgUrl = '../image/bank/qty.png';
										break;
							}
							var orderLi = '<div class="bankCardClass" bankCard_Id = ' + data.data[0].id +
								' style="width: 3rem;height: 0.9rem;"><img src="' + data.data[0].imgUrl +
								'" style="width: 0.27rem;"><span style="color: #303030;font-size: 0.24rem;">' + data.data[0].bankName + ' (' +
								bankCard + ')</span></div><div style="color: #A0A0A0;">2小时内到账</div>';
							$(fragmentplanList).append(orderLi);
							$(".li_one_div").append($(fragmentplanList));
						}
					} else {
						tipShow(data.message)
					}
				});

				/* 获取用户余额 */
				getUserMoney(mui, plus.storage.getItem('memberId'), function(data) {
					if (data.code == 200) {
						$("#li_four_money").text(data.data.balance);
					} else if (data.code == 401 || data.code == 1500) {
						gotoLoginIn()
					} else {
						tipShow(data.message)
					}
				});
				/* 子页面调用父页面方法 */
				window.addEventListener('switchBankCard', function(event) {
					$(".li_one_div").html("")
					var fragmentplanList = document.createDocumentFragment();
					var orderLi = '<div class="bankCardClass" bankCard_Id = ' + event.detail.bankCardIdC +
						' style="width: 3rem;height: 0.9rem;"><img src="' + event.detail.imgUrl +
						'" style="width: 0.27rem;"><span style="color: #303030;font-size: 0.24rem;">' + event.detail.bankName + ' (' +
						event.detail.bankCard + ')</span></div><div style="color: #A0A0A0;">2小时内到账</div>';
					$(fragmentplanList).append(orderLi);
					$(".li_one_div").append($(fragmentplanList));
				});
				// 更换银行卡
				$(".li_two_div").on('tap', function() {
					$$.openWindow({
						url: 'bankCard.html',
						id: 'bankCard',
						show: {
							aniShow: "slide-in-right"
						}
					});
				});
				/* 密码框事件 */
				mui('#pay').on('tap', '.closeModel', function() {
					mui('#pay').popover('hide');
				});
				$('.zfinput').bind('input propertychange', function() {
					$('.table>div>.blackpwd').css('opacity', '0');
					var length = $(this).val().length;
					$('.table>div>.blackpwd').slice(0, length).css('opacity', '1');
					if (length >= 6) {
						var val = $('.zfinput').val(); //密码
						$('.table>div>.blackpwd').css('opacity', '0');
						$('.zfinput').val("");
						//请求密码校验接口
						var dataBaseTwo = {
							memberId: plus.storage.getItem('memberId'),
							password: val,
						};
						passwordCheck(mui, dataBaseTwo, function(data) {
							if (data.code == 200) {
								mui('#pay').popover('hide');
								var dataBase = {
									amount: balbnce_money,
									bankId: bankCard_Id,
									memberId: plus.storage.getItem('memberId'),
								}
								reflectBank(mui, dataBase, function(data) {
									if (data.code == 200) {
										var bankCIDD = data.data;
										$("#balbnce_money").val('')
										$$.openWindow({
											url: 'carryResult.html',
											id: 'carryResult',
											extras: {
												"bankCId": bankCIDD
											},
											show: {
												aniShow: "slide-in-right"
											}
										});
									} else {
										tipShow(data.message);
									}
								});
							} else {
								tipShow(data.message);
								$('.zfinput').val("");
							}
						});
					}
				});
				/* 提现点击事件 */
				$(".li_five").on("tap", function() {
					balbnce_money = $("#balbnce_money").val().replace(/\s*/g, "");
					if (!balbnce_money) {
						tipShow("请输入提现金额");
						return;
					} else if (Number(balbnce_money) < 10) {
						tipShow("提现金额必须大于10元");
						return;
					}else if (Number(balbnce_money) > 80000) {
						tipShow("单笔体现上限为80,000元");
						return;
					}  else if (Number(balbnce_money) > $("#li_four_money").text()) {
						tipShow("提现金额超出余额了");
						$("#balbnce_money").val("");
						return;
					}
					bankCard_Id = $(this).siblings(".li_one").children(".li_one_div").children(".bankCardClass").attr(
						"bankCard_Id");
					mui('#pay').popover('show');
					$(".number1").text("￥" + balbnce_money);
					// var bankCard_Id = $(this).siblings(".li_one").children(".li_one_div").children(".bankCardClass").attr(
					// 	"bankCard_Id");
					// var dataBase = {
					// 	amount: balbnce_money,
					// 	bankId: bankCard_Id,
					// 	memberId: plus.storage.getItem('memberId'),
					// }
					// reflectBank(mui, dataBase, function(data) {
					// 	if (data.code == 200) {
					// 		var bankCIDD = data.data
					// 		$$.openWindow({
					// 			url: 'carryResult.html',
					// 			id: 'carryResult',
					// 			extras: {
					// 				"bankCId": bankCIDD
					// 			},
					// 			show: {
					// 				aniShow: "slide-in-right"
					// 			}
					// 		});
					// 	} else {
					// 		tipShow(data.message);
					// 	}
					// });
				});

				/* 全部提现点击事件 */
				$("#allBalance").on("tap", function() {
					$("#balbnce_money").val($("#li_four_money").text());
				});

			}
		})(jQuery, document, mui);
	</script>

</html>
