<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>my_setting</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../css/font-awesome.min.css">
		<link rel="stylesheet" href="../css/mui.min.css">
		<link rel="stylesheet" href="../css/common.css">
		<link rel="stylesheet" href="../css/mobileReset.css">
		<link rel="stylesheet" type="text/css" href="../css/pages/mySetting.css" />
		<style type="text/css">
			/* .mui-switch.mui-active {
				border-color: #F42300;
				background-color: #F42300;
			} */
		</style>
		<script src="../js/rem_reset.js"></script>
	</head>
	<body onselectstart="return false;">
		<header class="header_white">
			<i id="returnTopPage_set"><img src="../image/returnButton.png" style="width: .22rem;height: .38rem;"></i>
			<span style="margin-right: 0.3rem;">设置</span>
		</header>
		<div class="content">
			<div class="settingList">
				<ul>
					<li class="settingPassword" href="../pages/pSetting.html" data-id='pSetting'><span>个人资料设置</span><i class="fa fa-angle-right"></i></li>
					<li class="settingPassword" href="../pages/cashPassword.html" data-id='cashPassword'><span>提现密码</span><i class="fa fa-angle-right"></i></li>
					<li class="switch" style="display: flex;">
						<div style="width: 86%;">提示音</div>
						<div class="mui-switch mui-switch-mini margin_top2" id="mySwitch">
							<div class="mui-switch-handle"></div>
						</div>
					</li>
					<li class="settingDelete"><span>清理缓存</span><i class="fa fa-angle-right"></i></li>
					<li id="service" data-id='aboutUs'><span>联系客服</span><i class="fa fa-angle-right"></i></li>
					<li class="settingPassword" href="../pages/aboutUs.html" data-id='aboutUs'><span>关于我们</span><i class="fa fa-angle-right"></i></li>
				</ul>
			</div>
			<div class="bottom_btn" id="goOut">
				退出当前账号
			</div>

		</div>

	</body>
	<script src="../js/jquery-1.11.2.min.js"></script>
	<script src="../js/mui.min.js"></script>
	<script src="../js/commonFun.js"></script>
	<script src="../js/requestFun.js"></script>
	<script>
		(function($, doc, $$, undefined) {
			$$.init();
			var _self;
			if (window.plus) {
				plusReady();
			} else {
				doc.addEventListener('plusready', plusReady, false);
			}

			function plusReady() {
				plus.navigator.setFullscreen(false);
				//强制竖屏
				plus.screen.lockOrientation("portrait-primary");
				//强制隐藏滚动条
				plus.webview.currentWebview().setStyle({
					scrollIndicator: 'none'
				});
				_self = plus.webview.currentWebview();
				
				$("#mySwitch").addClass("mui-active");
				
				// 清除缓存
				$(".settingList .settingDelete").on("tap", function() {
					plus.cache.calculate(function(size) {
						sizeCache = size;
						var size_m = parseFloat(sizeCache / (1024 * 1024)).toFixed(2);
						if (size_m > 1) {
							mui.confirm("您目前的系统缓存为" + size_m + "M", "清除缓存", ["确认", "取消"], function(e) {
								if (e.index == 1) {} else {
									plus.cache.clear(function() {
										alert("缓存清除完毕")
									});
								}
							});
						} else {
							alert('暂无内存可清除')
						}
					});
				});
				// 是否关闭推送播放
				var whetherPush = plus.storage.getItem('whetherPush');
				if (whetherPush) {
					$(".mui-switch").addClass("mui-active") //默认打开
				} else {
					$(".mui-switch").removeClass("mui-active");//默认关闭
				}
				document.getElementById("mySwitch").addEventListener("toggle", function(event) {
					var dataBase = {};
					if (event.detail.isActive) {
						console.log("你启动了开关");
						plus.storage.setItem('whetherPush', true);
						
						dataBase = {
							id:plus.storage.getItem('memberId'),
							isPhoneRingtone:"1",
						};
					} else {
						console.log("你关闭了开关");
						plus.storage.setItem('whetherPush', false);
						dataBase = {
							id:plus.storage.getItem('memberId'),
							isPhoneRingtone:"0",
						};
					}
					
					setPhoneRingtone(mui, dataBase, function(data) {
					    if (data.code == 200) {  
							tipShow("修改成功");
						} else {
						    tipShow(data.message);
						}
					});
				})
				/* 联系客户 */
				$("#service").on("tap", function() {
					var phone = "18048334993";
					if (plus.os.name == "Android") {
						var btnArray = ['拨打', '取消'];
						var phone = "18048334993";
						mui.confirm(phone, '提示', btnArray, function(e) {
							if (e.index == 0) {
								/* var Intent = plus.android.importClass("android.content.Intent");
								var Uri = plus.android.importClass("android.net.Uri");
								var main = plus.android.runtimeMainActivity();
								var uri = Uri.parse("tel:" + phone);
								var call = new Intent("android.intent.action.CALL", uri);
								main.startActivity(call); */
								//window.location.href = 'tel:123456789';
								plus.device.dial(phone, false);
							}

						});
					} else {
						var UIAPP = plus.ios.importClass("UIApplication");
						var NSURL = plus.ios.importClass("NSURL");
						var app = UIAPP.sharedApplication();
						app.openURL(NSURL.URLWithString("tel://" + phone));
					}

				})


				//页面跳转serviceModuer
				$('.settingPassword').on('tap', function(e) {
					// 获取页面ID
					var urlId = $(this).attr("data-id");
					// 获取路径
					var urlRout = this.getAttribute('href');
					/* 	if (urlRout == "../pages/cashPassword.html") {
							//判断是否有提现密码
							isSetPassword(mui, plus.storage.getItem('memberId'), function(data) {
								//console.log("判断是否有提现密码==" + JSON.stringify(data))
								if (data.code == 500) {
									$$.openWindow({
										url: 'setPassword.html',
										id: 'setPassword',
										show: {
											aniShow: "slide-in-right"
										}
									});
								}
							});
						} else { */
					if (urlRout && urlId) {
						$$.openWindow({
							url: urlRout,
							id: urlId,
							show: {
								aniShow: "slide-in-right"
							}
						});
					} else {
						console.log('缺少页面路径')
					}
					//}
				});

				/* 返回上一页 */
				var returnTopPage_set = doc.getElementById("returnTopPage_set");
				returnTopPage_set.onclick = function() {
					plus.nativeUI.closeWaiting();
					mui.back();
					var list = plus.webview.currentWebview().opener();
					mui.fire(list, 'refreshMajorGuestCount');
				}

			}
			// 退出登录
			$('#goOut').on('tap', function() {
				getLogOut(mui, function(data) {
					if (data.code == 200) {
						clearStorage(); //清空缓存数据
						var list = plus.webview.currentWebview().opener();
						mui.fire(list, 'refreshMajorGuestCount');
						var ws = plus.webview.currentWebview();
						plus.webview.close(ws);
					}
				});

				// // 回到tab页面
				// var ws = plus.webview.currentWebview();
				// plus.webview.close(ws);
				// var _subWv = plus.webview.getWebviewById('personalCenter.html');
				// //如果不存在则创建
				// if(!_subWv) {
				// 	_subWv = plus.webview.create("views/" + targetTab, targetTab, subpage_style);
				// 	self.append(_subWv);
				// }
				// _subWv.show();
				// plus.webview.getWebviewById('personalCenter.html').reload();
			})
		})(jQuery, document, mui);
	</script>

</html>
